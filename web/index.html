<!DOCTYPE html>
<html>
<head>
    <title>MATERA - Gente em Ação</title>
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js" integrity="sha384-b/U6ypiBEHpOf/4+1nzFpr53nxSS+GLCkfwBdFNTxtclqqenISfwAzpKaMNFNmj4" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/css/bootstrap.min.css" integrity="sha384-/Y6pD6FV/Vv2HJnA6t+vslU6fwYXjCFtcEpHbNJ0lyAFsXTsjBbfaDjzALeQsN6M" crossorigin="anonymous">
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/js/bootstrap.min.js" integrity="sha384-h0AbiXch4ZDo7tp9hKZ4TsHbi047NrKGLO3SEJAg45jXxnGIfYzk4Si90RDIqNm1" crossorigin="anonymous"></script>
    <script src="../js/angular/angular.min.js"></script>
    <script src="../js/event-controller.js"></script>
    <meta charset='utf-8' />
</head>
<body ng-app="matera" ng-controller="EventController" id="page">
    <nav class="navbar navbar-dark bg-primary">
      <div class="dropdown">
        <button class="btn btn-primary dropdown-toggle" type="button" data-toggle="dropdown">Aulas
        <span class="caret"></span></button>
        <ul class="dropdown-menu">
          <li><a href="#" ng-click="showClassWithNoTeacher()">Sem Professor</a></li>
          <li><a href="#" ng-click="showAllEvents()">Todas</a></li>
          <li><a href="#" ng-click="showMyClasses()">Minhas Aulas</a></li>
        </ul>
      </div>
      <a class="navbar-brand" href="#"><b>Área do Professor | Educa+</b></a>
      <form class="navbar-form navbar-left">
        <button id="authorize-button" style="display: none;">Entrar</button>
        <button id="signout-button" style="display: none;">Sair</button>
      </form>
    </nav>

    <div style="padding: 15px">
      <div class="card col-sm-3" ng-repeat="event in events track by $index" style="box-shadow: 3px 3px grey; float: left; margin: 15px;">
        <div class="card-body">
            <h4 class="card-title">Aula Educa+</h4>
            <h4 ng-show="event.teacher != null">Professor: {{event.teacher}}</h4>
            <h4 ng-show="event.teacher == null" style="color: red;">Sem Professor!</h4>
            <h4>Dia {{!event.start.dateTime ? event.start.date : event.start.dateTime | date:'dd/MM/yyyy'}} às {{!event.start.dateTime ? event.start.date : event.start.dateTime | date:'HH:mm'}}h</h4>
            <p class="card-text">{{event.summary}}</p>
            <a ng-click="eventDetails(event)" class="btn btn-primary" data-toggle="eventDetailsModal" data-target="#eventDetailsModal">Informações</a>
            <a ng-click="editDescription(event)" class="btn btn-primary" data-toggle="editDescriptionModal" data-target="#editDescriptionModal">Editar Diário</a>
        </div>
      </div>
    </div>

    <div class="modal fade" id="eventDetailsModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLabel"><b>Informações da Aula Educa+</b></h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <b>Quando?</b>
            <p>{{!event.start.dateTime ? event.start.date : event.start.dateTime | date:'dd/MM/yyyy'}} às {{!event.start.dateTime ? event.start.date : event.start.dateTime | date:'HH:mm'}}h</p>
            <b>Onde?</b>
            <p><a href="#" ng-click="openInMap(event.location)">{{event.location}}</a></p>
            <b ng-show="event.description">Diário do Professor:</b>
            <p ng-show="event.description">{{event.description}} <a href="#" ng-click="editDescription(event)" data-dismiss="modal" style="font-size: 12px;">Editar</a></p>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-primary" data-dismiss="modal">Fechar</button>
          </div>
        </div>
      </div>
    </div>

    <div class="modal fade" id="editDescriptionModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLabel"><b>Aula de {{!event.start.dateTime ? event.start.date : event.start.dateTime | date:'dd/MM/yyyy'}}</b></h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <form>
              <div class="form-group">
                <label for="description"><b>Diário do Professor:</b></label>
                <textarea class="form-control" id="description" rows="3" ng-model="event.description"></textarea>
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-primary" ng-click="updateEvent(event)">Salvar</button>
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Fechar</button>
          </div>
        </div>
      </div>
    </div>

    <script type="text/javascript">
        var CLIENT_ID = '319646018962-hufl8m8oojkt9umbr4j9escjfdi8vpkl.apps.googleusercontent.com';
        var DISCOVERY_DOCS = ["https://www.googleapis.com/discovery/v1/apis/calendar/v3/rest"];
        var SCOPES = "https://www.googleapis.com/auth/calendar";

        var authorizeButton = document.getElementById('authorize-button');
        var signoutButton = document.getElementById('signout-button');
        var createButton = document.getElementById('create-button');

        function handleClientLoad() {
          gapi.load('client:auth2', initClient);
        }

        function initClient() {
          gapi.client.init({
              discoveryDocs: DISCOVERY_DOCS,
              clientId: CLIENT_ID,
              scope: SCOPES
          }).then(function () {
              // Listen for sign-in state changes.
              gapi.auth2.getAuthInstance().isSignedIn.listen(updateSigninStatus);
              // Handle the initial sign-in state.
              updateSigninStatus(gapi.auth2.getAuthInstance().isSignedIn.get());
              authorizeButton.onclick = handleAuthClick;
              signoutButton.onclick = handleSignoutClick;
          });
        }

        function updateSigninStatus(isSignedIn) {
          if (isSignedIn) {
              authorizeButton.style.display = 'none';
              signoutButton.style.display = 'block';
              angular.element(document.getElementById('page')).scope().getAllEvents();
          } else {
              authorizeButton.style.display = 'block';
              signoutButton.style.display = 'none';
          }
        }

        function handleAuthClick(event) {
          gapi.auth2.getAuthInstance().signIn();
        }

        function handleSignoutClick(event) {
          gapi.auth2.getAuthInstance().signOut();
          angular.element(document.getElementById('page')).scope().signOut();
        }
    </script>

    <script async defer src="https://apis.google.com/js/api.js"
      onload="this.onload=function(){};handleClientLoad()"
      onreadystatechange="if (this.readyState === 'complete') this.onload()">
    </script>
</body>
</html>